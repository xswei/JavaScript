### 客户端JavaScript

#### 1. 客户端JavaScript时间线

- 浏览器创建Document对象，并解析Web页面，解析HTML元素和它的文本内容并添加Element对象和Text节点到文档中。此时document.readystate属性的值是loading
- 解析过程中遇到没有anync和defer属性的script元素时，会把这些元素添加到文档中，并执行内部或外部脚本，此时解析器会暂停
- 遇到anync属性的script元素时，会开始下载脚本，并继续解析文档，脚本会在下载完成后尽快执行，但是解析器不会暂停，此时脚本可能不能访问完整的文档树
- 文档解析完成，document.readyState属性变成interactive
- 所有带defer属性的脚本会按照在文档里出现的次序执行，异步脚本也可能在这个阶段执行，延迟脚本能访问完整的文档树。
- 浏览器在Doucment对象上触发DOMContentLoaded事件
- 文档解析完全完成，但此时可能有其他的资源需要载入，比如图片等。此时document.readyState属性为complete，并触发window上的onload事件
- 调用异步事件，以异步响应用户的输入事件，网络事件等

#### 2. 怪异模式和标准模式

MS在发布IE6时，添加了IE5里没有的CSS特性，但为了确保兼容性，在IE6中定义了两种渲染模式，也就是标准模式和怪异模式。在IE6中使用怪异模式时浏览器的渲染与IE5没有区别。

浏览器以哪种模式渲染文档，是通过HTML文件头部的DOCTYPE声明确定的，在IE6中如果没有DOCTYPE或者其他类型的声明时，会按照怪异模式进行渲染。当HTML文件定义了严格的DOCTYPE声明时，会按照标准模式渲染。

判断当前渲染模式可以通过document.compatMode属性，当值为"CSS1Compat"时，说明浏览器在标准模式下工作，当值为"BackCompat"(或undefined或属性不存在)时，说明页面处于怪异模式。

#### 3. 可访问性

可访问性是指设计的代码在某些禁用JavaScript解释器的浏览器中也能正常使用，此外还有一个原则就是要考虑某些不能使用键盘或鼠标的用户。

#### 4. 安全性

##### 浏览器中的JavaScript不能做什么

web浏览器为了保证用户设备的安全，禁用了JavaScript的一些功能，比如浏览器中的JavaScript没有权限写入或删除客户计算机上的任意文件或列出任意目录。

此外浏览器还限制了一些JavaScript的某些功能：

- 不允许不经过用户确认就关闭其他窗口
- 只有响应用户鼠标事件时才能打开一个窗口
- HTML FileUpload元素的value属性只读
-不能从不同服务器上载入文档内容，除非是脚本文件，也就是同源策略

##### 同源策略

同源策略就是脚本只能读取和所属文档来源相同的窗口和文档的属性。

同源是指协议、主机、以及载入URL的端口一直，注意脚本的来源和同源不是一个概念，同源是指脚本所属的文档的来源，因此script元素不受同源策略的影响。

如果存在多级域名，则需要将document.domian属性设置为一级域名，则网站的多个域名之间就可以相互通信。

##### XSS

跨站脚本是指攻击者向目标站点注入HTML标签或脚本。预防跨站攻击的方式就是根据不可信的数据来源动态创建文档内容之前先移除HTML标签。

